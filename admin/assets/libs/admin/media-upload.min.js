(function($) {
    "use strict";
    "use strict";
    $('.button-media-select').on('click', function(){
        var id   = $(this).attr('data-id');
        var send = $(this).attr('data-send');
        $.ajax({
            url: admin_media_upload_url,
            type: 'post',
            data: 'action=handler&send'+send+'&id='+id,
            success: function (data) {
                var win = window.dialogArguments || opener || parent || top;
                win.tb_remove();
                if(send == 'gallery')
                {
                    /* <![CDATA[ */
                    win.send_to_gallery(data);
                    /* ]]> */
                }
                else
                {
                    /* <![CDATA[ */
                    win.send_to_editor(data);
                    /* ]]> */
                }         
            }
        }); 
    });
    $('.creative-media-upload-sidemenu a').on('click', function(){
        $('.creative-media-upload-sidemenu a').removeClass('current');
        $(this).addClass('current');
        var tab_content = $(this).data('type');
        $('.content-tab').addClass('hidden');
        $('.content-'+tab_content).removeClass('hidden');
    });
    
    $(document).on('click', '.media-attachments li',function(){
        var sel = $(this).attr('class');
        var id = $(this).attr('data-id');
        $('.media-attachments li').removeClass('selectd');
        if( sel === 'selectd' )
        {
            $(this).removeClass('selectd');
            $('.button-media-select').attr('data-id', '0').prop('disabled', true);
        }
        else
        {
            $(this).addClass('selectd');
            $('.button-media-select').attr('data-id', id).prop('disabled', false);
        }
    });
    var thelast = false;
    $(".media-items-library").scroll(function() {
        var $this = $(this);
        var $results = $(".media-items-library .media-attachments");
        if ($(this).attr("data-loading") == '0' && $(this).attr("data-thelast") == '0') {
            if ($this.scrollTop() + $this.height() + 30 >= $results.height()) {
                pageload = pageload + 1;
                $.ajax({
                    url: admin_media_upload_url,
                    type: "post",
                    data: {action: 'loadmedia',page: pageload},
                    beforeSend: function(xhr) {
                        $(".media-items-library").after($("<li class='media-loading'></li>").fadeIn('slow')).attr("data-loading", '1');
                    },
                    success: function(data) {
                        $(".media-loading").fadeOut('fast', function() {
                            $(this).remove();
                        });
                        var $results = $(".media-items-library .media-attachments");
                        console.log(data);
                        if(data)
                        {
                            $results.append(data);
                        }
                        else
                        {
                            $(".media-items-library").attr("data-thelast", '1');
                            
                        }
                        $(".media-items-library").attr('data-loading', '0');
                    }
                });
            }
        }
    });
})(jQuery);